---
- name: Configure APT system management
  ansible.builtin.include_tasks: apt_management.yml
  tags: ["packages", "apt", "config"]

- name: Configure APT settings
  ansible.builtin.include_tasks: apt_config.yml
  when:
      - packages_apt_conf | length > 0
      - packages_cache_enabled | default(true) | bool
  tags: ["packages", "config"]

- name: Configure APT repositories
  ansible.builtin.include_tasks: repositories.yml
  when:
      - packages_repositories | length > 0
      - packages_repositories_enabled | default(true) | bool
  tags: ["packages", "repositories"]

- name: Configure APT keys
  ansible.builtin.include_tasks: keys.yml
  when:
      - packages_keys | length > 0
      - packages_keys_enabled | default(true) | bool
  tags: ["packages", "keys"]

- name: Update package cache
  ansible.builtin.include_tasks: cache.yml
  when:
      - packages_update_cache
      - packages_cache_enabled | default(true) | bool
  tags: ["packages", "cache"]

- name: Upgrade packages
  ansible.builtin.include_tasks: upgrade.yml
  when:
      - packages_upgrade
      - packages_upgrade_enabled | default(false) | bool
  tags: ["packages", "upgrade"]

- name: Process unified package list
  ansible.builtin.include_tasks: packages.yml
  when: packages_list | length > 0
  tags: ["packages", "unified"]

- name: Clean package cache
  ansible.builtin.include_tasks: clean.yml
  when:
      - packages_autoclean or packages_autoremove
      - packages_clean_enabled | default(false) | bool
  tags: ["packages", "clean"]

- name: Configure unattended-upgrades
  ansible.builtin.include_tasks: unattended_upgrades.yml
  when: packages_unattended_upgrades_enabled | default(false) | bool
  tags: ["packages", "unattended-upgrades"]
